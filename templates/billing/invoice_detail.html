{% extends 'billing/base_billing.html' %}
{% load static %}

{% block title %}Invoice {{ invoice.invoice_number }} - King Dupatta House{% endblock %}

{% block extra_css %}
<style>
    .invoice-detail-container {
        background: white;
        border-radius: 20px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        border: 1px solid #e5e7eb;
        overflow: hidden;
        margin: 2rem 0;
    }
    
    /* Header Section - Matching Print Design */
    .header-section {
        display: flex;
        margin-bottom: 0;
    }
    
    .company-logo-section {
        background: #1e3a8a;
        color: white;
        padding: 20px;
        border-radius: 0 0 20px 0;
        flex: 1;
    }
    
    .company-logo {
        font-size: 2.5rem;
        font-weight: bold;
        margin-bottom: 10px;
    }
    
    .company-name {
        font-size: 1.8rem;
        font-weight: bold;
        margin-bottom: 15px;
    }
    
    .gst-info {
        background: #1e40af;
        color: white;
        padding: 8px;
        border-radius: 5px;
        font-size: 0.9rem;
    }
    
    .contact-section {
        background: #8b5cf6;
        color: white;
        padding: 20px;
        flex: 1;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
    }
    
    .contact-row {
        display: flex;
        gap: 20px;
        margin-bottom: 15px;
    }
    
    .contact-item {
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .invoice-title {
        font-size: 2rem;
        font-weight: bold;
        text-align: center;
        margin: 20px 0;
        color: #000;
    }
    
    .invoice-meta {
        text-align: right;
        color: #000;
    }
    
    .invoice-meta p {
        margin: 5px 0;
    }
    
    /* Bill To Section */
    .bill-to-section {
        margin: 20px 0;
        padding: 0 20px;
    }
    
    .bill-to-title {
        font-weight: bold;
        font-size: 1.1rem;
        margin-bottom: 10px;
    }
    
    .bill-to-name {
        font-size: 1.3rem;
        font-weight: bold;
        color: #000;
    }
    
    /* Items Table */
    .items-table {
        width: 100%;
        border-collapse: collapse;
        margin: 20px 0;
        background: white;
    }
    
    .items-table th {
        background: #8b5cf6;
        color: white;
        padding: 12px 8px;
        text-align: left;
        font-weight: bold;
    }
    
    .items-table td {
        padding: 12px 8px;
        border-bottom: 1px solid #e5e7eb;
    }
    
    .items-table tr:nth-child(even) {
        background: #f8fafc;
    }
    
    .items-table tr:last-child {
        background: #8b5cf6;
        color: white;
        font-weight: bold;
    }
    
    /* Payment Summary */
    .payment-summary {
        display: flex;
        justify-content: space-between;
        margin: 30px 0;
        padding: 0 20px;
    }
    
    .banking-details {
        flex: 1;
        margin-right: 20px;
    }
    
    .banking-details h3 {
        font-weight: bold;
        margin-bottom: 10px;
    }
    
    .banking-details p {
        margin: 5px 0;
    }
    
    .totals-table {
        width: 300px;
        border-collapse: collapse;
    }
    
    .totals-table td {
        padding: 8px 12px;
        border: 1px solid #d1d5db;
    }
    
    .totals-table .label {
        background: #f3f4f6;
        font-weight: bold;
    }
    
    .totals-table .total-row {
        background: #8b5cf6;
        color: white;
        font-weight: bold;
    }
    
    /* Amount in Words */
    .amount-words {
        background: #dbeafe;
        padding: 15px;
        border-radius: 8px;
        margin: 20px;
        border-left: 4px solid #3b82f6;
    }
    
    .amount-words strong {
        color: #1e40af;
    }
    
    /* Terms and Conditions */
    .terms-section {
        background: #fef3c7;
        padding: 15px;
        border-radius: 8px;
        margin: 20px;
        border-left: 4px solid #f59e0b;
    }
    
    .terms-section h3 {
        color: #92400e;
        margin-bottom: 10px;
    }
    
    .terms-section ol {
        margin-left: 20px;
    }
    
    .terms-section li {
        margin: 5px 0;
    }
    
    /* Action Buttons */
    .action-buttons {
        padding: 20px;
        background: #f8fafc;
        border-top: 1px solid #e5e7eb;
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
    }
    
    .btn-print {
        background: #8b5cf6;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 8px;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        font-weight: 500;
        transition: all 0.3s ease;
    }
    
    .btn-print:hover {
        background: #7c3aed;
        color: white;
        text-decoration: none;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
    }
    
    .btn-secondary {
        background: #6b7280;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 8px;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        font-weight: 500;
        transition: all 0.3s ease;
    }
    
    .btn-secondary:hover {
        background: #4b5563;
        color: white;
        text-decoration: none;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(107, 114, 128, 0.3);
    }
    
    /* Status Badge */
    .status-badge {
        display: inline-block;
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 0.875rem;
        font-weight: 500;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    .status-draft {
        background: #fef3c7;
        color: #92400e;
    }
    
    .status-sent {
        background: #dbeafe;
        color: #1e40af;
    }
    
    .status-paid {
        background: #d1fae5;
        color: #065f46;
    }
    
    .status-overdue {
        background: #fee2e2;
        color: #991b1b;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="invoice-detail-container">
        <!-- Header Section -->
        <div class="header-section">
            <div class="company-logo-section">
                <div class="company-logo">KDH</div>
                <div class="company-name">KING DUPATTA HOUSE</div>
                <div class="gst-info">
                    <strong>GSTIN:</strong> {{ invoice.company.gst_number }} | 
                    <strong>State:</strong> 09 - Uttar Pradesh
                </div>
            </div>
            
            <div class="contact-section">
                <div class="contact-row">
                    <div class="contact-item">
                        <span>üìû</span>
                        <span>{{ invoice.company.phone }}</span>
        </div>
                    <div class="contact-item">
                        <span>üìß</span>
                        <span>{{ invoice.company.email }}</span>
                    </div>
                    <div class="contact-item">
                        <span>üìç</span>
                        <span>{{ invoice.company.address }}</span>
                    </div>
                </div>
                
                <div class="invoice-title">Tax Invoice</div>
                
                <div class="invoice-meta">
                    <p><strong>Invoice No:</strong> {{ invoice.invoice_number }}</p>
                    <p><strong>Date:</strong> {{ invoice.date|date:"d/m/Y" }}</p>
                    <p><strong>Status:</strong> <span class="status-badge status-{{ invoice.status }}">{{ invoice.status|title }}</span></p>
            </div>
        </div>
    </div>

        <!-- Bill To Section -->
        <div class="bill-to-section">
            <div class="bill-to-title">Bill To:</div>
            <div class="bill-to-name">{{ invoice.customer.name }}</div>
                {% if invoice.customer.email %}
            <p>üìß {{ invoice.customer.email }}</p>
                {% endif %}
                {% if invoice.customer.phone %}
            <p>üìû {{ invoice.customer.phone }}</p>
                {% endif %}
                {% if invoice.customer.address %}
            <p>üìç {{ invoice.customer.address }}</p>
                {% endif %}
                {% if invoice.customer.gst_number %}
            <p>üè¢ GST: {{ invoice.customer.gst_number }}</p>
                {% endif %}
    </div>

        <!-- Items Table -->
        <div style="padding: 0 20px;">
            <table class="items-table">
                        <thead>
                            <tr>
                        <th>#</th>
                        <th>Item Name</th>
                        <th>HSN/SAC</th>
                        <th>Quantity</th>
                        <th>Price/Unit</th>
                        <th>GST</th>
                        <th>Amount</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for item in invoice.items.all %}
                            <tr>
                        <td>{{ forloop.counter }}</td>
                                <td>{{ item.description }}</td>
                        <td>-</td>
                                <td>{{ item.quantity }}</td>
                                <td>‚Çπ{{ item.unit_price|floatformat:2 }}</td>
                        <td>‚Çπ{{ item.tax_amount|floatformat:2 }} ({{ item.tax_rate|floatformat:1 }}%)</td>
                        <td>‚Çπ{{ item.total_price|floatformat:2 }}</td>
                            </tr>
                            {% endfor %}
                    <tr>
                        <td>Total</td>
                        <td></td>
                        <td></td>
                        <td>{{ invoice.items.count }}</td>
                        <td></td>
                        <td>‚Çπ{% widthratio invoice.tax_amount 2 1 %}</td>
                        <td>‚Çπ{{ invoice.total_amount|floatformat:2 }}</td>
                    </tr>
                        </tbody>
                    </table>
                </div>
        
        <!-- Payment Summary -->
        <div class="payment-summary">
            <div class="banking-details">
                <h3>Pay To:</h3>
                <p><strong>Bank Name:</strong> {{ invoice.company.bank_name|default:"HDFC BANK, LUCKNOW CHOWK - UTTAR PRADESH" }}</p>
                <p><strong>Account No:</strong> {{ invoice.company.account_number|default:"50200016138197" }}</p>
                <p><strong>IFSC Code:</strong> {{ invoice.company.ifsc_code|default:"HDFC0000596" }}</p>
                <p><strong>Account Holder:</strong> AHTIRAM ALI ANSARI</p>
            </div>
            
            <div>
                <table class="totals-table">
                    <tr>
                        <td class="label">Sub Total:</td>
                        <td>‚Çπ{{ invoice.subtotal|floatformat:2 }}</td>
                    </tr>
                    <tr>
                        <td class="label">CGST@2.5%:</td>
                        <td>‚Çπ{% widthratio invoice.tax_amount 2 1 %}</td>
                    </tr>
                    <tr>
                        <td class="label">SGST@2.5%:</td>
                        <td>‚Çπ{% widthratio invoice.tax_amount 2 1 %}</td>
                    </tr>
                    <tr class="total-row">
                        <td class="label">Total:</td>
                        <td>‚Çπ{{ invoice.total_amount|floatformat:2 }}</td>
                    </tr>
                    <tr>
                        <td class="label">Received:</td>
                        <td>‚Çπ{{ invoice.total_amount|floatformat:2 }}</td>
                    </tr>
                    <tr>
                        <td class="label">Balance:</td>
                        <td>‚Çπ0.00</td>
                    </tr>
                </table>
            </div>
        </div>
        
        <!-- Amount in Words -->
        <div class="amount-words">
            <strong>Invoice Amount In Words:</strong> {{ invoice.total_amount|floatformat:0|add:"0" }} Rupees Only
        </div>
        
        <!-- Terms and Conditions -->
        <div class="terms-section">
            <h3>Terms And Conditions:</h3>
            <ol>
                <li>No Exchange On Sunday.</li>
                <li>Exchange Within A Week.</li>
                <li>No Return Of Money.</li>
            </ol>
    </div>

    <!-- Notes -->
    {% if invoice.notes %}
        <div class="notes-section" style="padding: 0 20px; margin: 20px 0;">
            <h3>Notes:</h3>
            <p>{{ invoice.notes }}</p>
    </div>
    {% endif %}

        <!-- Action Buttons -->
        <div class="action-buttons">
            <a href="{% url 'billing:invoice_print' invoice_id=invoice.id %}" class="btn-print">
                üñ®Ô∏è Print Invoice
            </a>
            <a href="{% url 'billing:invoice_list' %}" class="btn-secondary">
                ‚Üê Back to Invoices
            </a>
            {% if invoice.status == 'draft' %}
            <a href="{% url 'billing:invoice_edit' invoice_id=invoice.id %}" class="btn-secondary">
                ‚úèÔ∏è Edit Invoice
            </a>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}